<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>nothing0x00 - CTF</title><link href="/" rel="alternate"></link><link href="/feeds/ctf.atom.xml" rel="self"></link><id>/</id><updated>2020-02-10T00:00:00-05:00</updated><subtitle>Reflections on Hacking, Information Theory and Random Ephemera</subtitle><entry><title>Walkthrough: Dusk CTF</title><link href="/dusk.html" rel="alternate"></link><published>2020-02-10T00:00:00-05:00</published><updated>2020-02-10T00:00:00-05:00</updated><author><name>nothing0x00</name></author><id>tag:None,2020-02-10:/dusk.html</id><summary type="html">&lt;p&gt;Walkthrough for Dusk CTF&lt;/p&gt;</summary><content type="html">&lt;p&gt;This is the first in a series of CTF walkthroughs. The goal of this series is to demonstrate the pathway from boot to root, and to do so with an eye toward clarity and an incremental stepping through of the process used to solve the machine.  More of these walkthroughs will be posted as they become relevant, and as I have the time to complete machines.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note: At no point will there be information related to current, non-retired, machines on HackTheBox, or any walkthroughs of the OSCP labs, nor will I respond to inquiries about how to complete these machines&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;So, with that, let's begin...&lt;/p&gt;
&lt;p&gt;When the machine boots it is allocated an IP of 192.68.56.108 (running on a Host-Only network in VirtualBox).&lt;/p&gt;
&lt;p&gt;Initial nmap scanning shows that ports 21, 22, 25, 80, 3306 and 8080 are open.&lt;/p&gt;
&lt;p&gt;&lt;img alt="nmap_image" src="/images/dusk/nmap.png"&gt;&lt;/p&gt;
&lt;p&gt;More detailed scanning did not show any obvious pathways of attack, with most services reporting back as expected. After a significant amount of enumeration the best pathway forward seemed to be to brute force a way into the machine.&lt;/p&gt;
&lt;p&gt;Attempts were made to brute force the FTP service, with no luck. Eventually I succeeded in grabbing valid credentials for the MariaDb service on port 3306, using the mysql-brute NSE script within nmap.&lt;/p&gt;
&lt;p&gt;&lt;img alt="mysql_brute_force" src="/images/dusk/mysql_brute.png"&gt;&lt;/p&gt;
&lt;p&gt;Using these credentials it was possible to log into the database remotely.&lt;/p&gt;
&lt;p&gt;&lt;img alt="mysql_login" src="/images/dusk/mysql_login.png"&gt;&lt;/p&gt;
&lt;p&gt;The database itself did not return any useful information, but because the service on port 8080 is running PHP, and because it is possible to write to the filesystem as root in SQL databases, it is theoretically possible to write a webshell to the system and access it over port 8080.&lt;/p&gt;
&lt;p&gt;The service on port 8080 is utilizing /var/tmp as a webroot, as indicated by the information displayed by the service.&lt;/p&gt;
&lt;p&gt;&lt;img alt="webroot" src="/images/dusk/8080_working_dir.png"&gt;&lt;/p&gt;
&lt;p&gt;Using the information gathered about the service it was possible to utilize the database access to write a PHP webshell to the webserver using the following command:&lt;/p&gt;
&lt;p&gt;&lt;img alt="webshell_write" src="/images/dusk/shell_write.png"&gt;&lt;/p&gt;
&lt;p&gt;The shell was then accessed at http://192.168.56.108:8080/shell2.php with commands run through the cmd parameter.&lt;/p&gt;
&lt;p&gt;&lt;img alt="webshell" src="/images/dusk/webshell.png"&gt;&lt;/p&gt;
&lt;p&gt;Using netcat a command was constructed which generated a reverse shell from the target to the attacking machine.&lt;/p&gt;
&lt;p&gt;&lt;img alt="webshell_reverse" src="/images/dusk/webshell_reverse.png"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;img alt="webshell_handler" src="/images/dusk/webshell_reverse_handler.png"&gt;&lt;/p&gt;
&lt;p&gt;After initial access was gained it was possible to grab the user flag.&lt;/p&gt;
&lt;p&gt;&lt;img alt="user_flag" src="/images/dusk/user.png"&gt;&lt;/p&gt;
&lt;p&gt;Next, I moved to /tmp, pulled down LinEnum and started enumeration.&lt;/p&gt;
&lt;p&gt;The initial run showed that the www-data user was able to run ping, make and sl with sudo privileges without providing a password.&lt;/p&gt;
&lt;p&gt;&lt;img alt="sudo_privs" src="/images/dusk/sudo_privs.png"&gt;&lt;/p&gt;
&lt;p&gt;Additionally, the process tree dump contained the credentials used for the FTP server, which for pyftplib are contained in the launch command.&lt;/p&gt;
&lt;p&gt;&lt;img alt="ftp_creds" src="/images/dusk/pyftp_creds.png"&gt;&lt;/p&gt;
&lt;p&gt;Using these credentials I was able to log into the FTP service, which granted me read access to the /root directory, where I was able to grab the flag.&lt;/p&gt;
&lt;p&gt;&lt;img alt="root_ftp" src="/images/dusk/root_ftp.png"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;img alt="r00ted" src="/images/dusk/root_flag.png"&gt;&lt;/p&gt;</content><category term="CTF"></category><category term="#CTF"></category></entry></feed>